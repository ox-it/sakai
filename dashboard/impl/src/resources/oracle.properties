# Oracle SQL Statements

create.AvailabilityCheck.table = create table dash_availability_check \
( id number not null primary key, entity_ref varchar2(255) not null, \
entity_type_id varchar2(255) not null, scheduled_time timestamp(0) not null); \
create sequence dash_availability_check_seq start with 1 increment by 1 nomaxvalue; \
create unique index dash_avail_check_idx on dash_availability_check(entity_ref, scheduled_time); \
create index dash_avail_check_time_idx on dash_availability_check(scheduled_time)

create.CalendarItem.table = create table dash_calendar_item \
( id number not null primary key, calendar_time timestamp(0) not null, calendar_time_label_key varchar2(40), \
title varchar2(255) not null, \
entity_ref varchar2(255) not null, entity_type number not null, subtype varchar2(255), context_id number not null, \
repeating_event_id number, sequence_num integer ); \
create sequence dash_calendar_item_seq start with 1 increment by 1 nomaxvalue; \
create index dash_cal_time_idx on dash_calendar_item (calendar_time); \
create unique index dash_cal_entity_label_idx on dash_calendar_item (entity_ref, calendar_time_label_key, sequence_num); \
create index dash_cal_entity_idx on dash_calendar_item (entity_ref)

create.CalendarLink.table = create table dash_calendar_link \
( id number not null primary key, person_id number not null, context_id number not null, \
item_id number not null, hidden number(1,0) default 0, sticky number(1,0) default 0, \
unique (person_id, context_id, item_id) ); \
create sequence dash_calendar_link_seq start with 1 increment by 1 nomaxvalue; \
create index dash_calendar_link_idx on dash_calendar_link (person_id, context_id, item_id, hidden, sticky)

create.Config.table = create table dash_config ( id number not null primary key, \
property_name varchar2(99) not null, property_value number(10,0) not null ); \
create sequence dash_config_seq start with 1 increment by 1 nomaxvalue; \ 
create unique index dash_config_name_idx on dash_config(property_name); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_DEFAULT_ITEMS_IN_PANEL', 5); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_DEFAULT_ITEMS_IN_DISCLOSURE', 20); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_DEFAULT_ITEMS_IN_GROUP', 2); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_REMOVE_NEWS_ITEMS_AFTER_WEEKS', 8); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_REMOVE_STARRED_NEWS_ITEMS_AFTER_WEEKS', 26); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_REMOVE_HIDDEN_NEWS_ITEMS_AFTER_WEEKS', 4); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_REMOVE_CALENDAR_ITEMS_AFTER_WEEKS', 2); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_REMOVE_STARRED_CALENDAR_ITEMS_AFTER_WEEKS', 26); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_REMOVE_HIDDEN_CALENDAR_ITEMS_AFTER_WEEKS', 1); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_REMOVE_NEWS_ITEMS_WITH_NO_LINKS', 1); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_REMOVE_CALENDAR_ITEMS_WITH_NO_LINKS', 1); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_DAYS_BETWEEN_HORIZ0N_UPDATES', 1); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_WEEKS_TO_HORIZON', 4); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_MOTD_MODE', 1); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_LOG_MODE_FOR_NAVIGATION_EVENTS', 2); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_LOG_MODE_FOR_ITEM_DETAIL_EVENTS', 2); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_LOG_MODE_FOR_PREFERENCE_EVENTS', 2); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_LOG_MODE_FOR_DASH_NAV_EVENTS', 2); \
insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, 'PROP_LOOP_TIMER_ENABLED', 0)  

create.Context.table = create table dash_context \
( id number not null primary key, context_id varchar2(255) not null, \
context_url varchar2(1024) not null, context_title varchar2(255) not null ); \
create sequence dash_context_seq start with 1 increment by 1 nomaxvalue; \
create unique index dash_context_idx on dash_context (context_id)

create.EventLog.table = create table dash_event (event_id number not null primary key, event_date timestamp with time zone, \
event varchar2 (32), ref varchar2 (255), context varchar2 (255), session_id varchar2 (163), event_code varchar2 (1)); \
create unique index dash_event_index on dash_event (event_id asc); \
create sequence dash_event_seq start with 1 increment by 1 nomaxvalue

create.NewsItem.table = create table dash_news_item ( id number not null primary key, \
news_time timestamp(0) not null, news_time_label_key varchar2(40), title varchar2(255) not null, \
entity_ref varchar2(255) not null, \
entity_type number not null, subtype varchar2(255), context_id number not null, grouping_id varchar2(90) ); \
create sequence dash_news_item_seq start with 1 increment by 1 nomaxvalue; \
create index dash_news_time_idx on dash_news_item (news_time); \
create index dash_news_grouping_idx on dash_news_item (grouping_id); \
create unique index dash_news_entity_idx on dash_news_item (entity_ref)

create.NewsLink.table = create table dash_news_link \
( id number not null primary key, person_id number not null, context_id number not null, \
item_id number not null, hidden number(1,0) default 0, sticky number(1,0) default 0, unique (person_id, context_id, item_id) ); \
create sequence dash_news_link_seq start with 1 increment by 1 nomaxvalue; \
create index dash_news_link_idx on dash_news_link (person_id, context_id, item_id, hidden, sticky)

create.Person.table = create table dash_person \
( id number not null primary key,user_id varchar2(99) not null, sakai_id varchar2(99) ); \
create sequence dash_person_seq start with 1 increment by 1 nomaxvalue; \
create unique index dash_person_user_id_idx on dash_person (user_id); \
create unique index dash_person_sakai_id_idx on dash_person (sakai_id)

create.RepeatingEvent.table = create table dash_repeating_event (id number not null primary key, \
first_time timestamp(0) not null, last_time timestamp(0), frequency varchar2(40) not null, max_count integer, \
calendar_time_label_key varchar2(40), title varchar2(255) not null, \
entity_ref varchar2(255) not null, subtype varchar2(255), entity_type number not null, context_id number not null ); \
create sequence dash_repeating_event_seq start with 1 increment by 1 nomaxvalue; \
create index dash_repeating_event_first_idx on dash_repeating_event (first_time); \
create index dash_repeating_event_last_idx on dash_repeating_event (last_time)

create.SourceType.table = create table dash_sourcetype \
( id number not null primary key, identifier varchar2(255) not null ); \
create sequence dash_sourcetype_seq start with 1 increment by 1 nomaxvalue; \
create unique index dash_source_idx on dash_sourcetype (identifier)

delete.AvailabilityChecks.before.date = delete from dash_availability_check where scheduled_time < ?

delete.AvailabilityChecks.by.entityReference = delete from dash_availability_check where entity_ref = ?

delete.CalendarItem.by.id = delete from dash_calendar_item where id=?

delete.CalendarItems.no.links = delete from dash_calendar_item item where not exists (select * from dash_calendar_link link where item.id=link.item_id) and item.entity_ref not in (select entity_ref from dash_availability_check)

delete.CalendarLink.by.personId.itemId = delete from dash_calendar_link where person_id=? and item_id=?

delete.CalendarLinks.by.itemId = delete from dash_calendar_link where item_id=?

delete.CalendarLinks.by.person.context = delete from dash_calendar_link where person_id=? and context_id=?

delete.CalendarLinks.by.item_calendarTime.starred.hidden = delete from dash_calendar_link where item_id in (select id from dash_calendar_item where calendar_time < ?) and sticky=? and hidden=?

delete.CalendarLinks.by.context = delete from DASH_CALENDAR_LINK \
where ID in \
( \
select t1.ID \
from DASH_CALENDAR_LINK t1, DASH_CONTEXT t2 \
where t1.CONTEXT_ID = t2.ID \
and t2.CONTEXT_ID = ? \
)

delete.NewsItem.by.id = delete from dash_news_item where id=?

delete.NewsItems.no.links = delete from dash_news_item item where not exists (select * from dash_news_link link where item.id=link.item_id)

delete.NewsLink.by.personId.itemId = delete from dash_news_link where person_id=? and item_id=?

delete.NewsLinks.by.itemId = delete from dash_news_link where item_id=?

delete.NewsLinks.by.person.context = delete from dash_news_link where person_id=? and context_id=?

delete.NewsLinks.by.item_newsTime.starred.hidden = delete from dash_news_link where item_id in (select id from dash_news_item where news_time < ?) and sticky=? and hidden=?

delete.NewsLinks.by.context = delete from DASH_NEWS_LINK \
where ID in \
( \
select t1.ID \
from DASH_NEWS_LINK t1, DASH_CONTEXT t2 \
where t1.CONTEXT_ID = t2.ID \
and t2.CONTEXT_ID = ? \
)

insert.AvailabilityCheck = insert into dash_availability_check (id, entity_ref, entity_type_id, scheduled_time) \
values (dash_availability_check_seq.nextval, ?, ?, ?)

insert.CalendarItem = insert into dash_calendar_item (id, calendar_time, calendar_time_label_key, title, entity_ref, subtype, entity_type, context_id) \
values (dash_calendar_item_seq.nextval, ?, ?, ?, ?, ?, ?, ?)

insert.CalendarItem.repeats = insert into dash_calendar_item (id, calendar_time, calendar_time_label_key, title, entity_ref, subtype, entity_type, \
context_id, repeating_event_id, sequence_num) values (dash_calendar_item_seq.nextval, ?, ?, ?, ?, ?, ?, ?, ?, ?)

insert.CalendarLink = insert into dash_calendar_link (id, person_id, item_id, context_id, hidden, sticky) \
values (dash_calendar_link_seq.nextval, ?, ?, ?, ?, ?)

insert.Config = insert into dash_config (id, property_name, property_value) values (dash_config_seq.nextval, ?, ?)

insert.Context = insert into dash_context (id, context_id, context_url, context_title) values (dash_context_seq.nextval, ?, ?, ?)

insert.EventLog = insert into dash_event (event_id, event_date, event, ref, context, session_id, event_code) values (dash_event_seq.nextval, ?, ?, ?, ?, ?, ?)

insert.NewsItem = insert into dash_news_item (id, news_time, title, news_time_label_key, entity_ref, subtype, entity_type, context_id, grouping_id) \
values (dash_news_item_seq.nextval, ?, ?, ?, ?, ?, ?, ?, ?)

insert.NewsLink = insert into dash_news_link (id, person_id, item_id, context_id, hidden, sticky ) \
values (dash_news_link_seq.nextval, ?, ?, ?, ?, ?)

insert.Person = insert into dash_person (id,user_id,sakai_id) values (dash_person_seq.nextval, ?, ?)

insert.RepeatingEvent = insert into dash_repeating_event (id, first_time, last_time, frequency, max_count, \
calendar_time_label_key, title, entity_ref, subtype, entity_type, context_id) values (dash_repeating_event_seq.nextval, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) 

insert.SourceType = insert into dash_sourcetype ( id, identifier) values (dash_sourcetype_seq.nextval, ?)

select.AvailabilityChecks.before.date = select * from dash_availability_check where scheduled_time < ?

select.AvailabilityChecks.entry = select * from dash_availability_check where entity_ref = ?

select.CalendarItem.by.entityReference.calendarTimeLabelKey = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_item ci join dash_context site on site.id=ci.context_id  \
join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where ci.entity_ref=? and ci.calendar_time_label_key=?

select.CalendarItem.by.entityReference.calendarTimeLabelKey.sequenceNumber = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_item ci join dash_context site on site.id=ci.context_id  \
join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where ci.entity_ref=? and ci.calendar_time_label_key=? and sequence_num=?

select.CalendarItem.by.entityReference.sequenceNumber = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_item ci join dash_context site on site.id=ci.context_id  \
join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where ci.entity_ref=? and ci.sequence_num=?

select.CalendarItem.by.id = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, st.id as type_id, ci.sequence_num as ci_sequence_num, \
st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_item ci join dash_context site on site.id=ci.context_id left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
join dash_sourcetype st on st.id=ci.entity_type where ci.id=?

select.CalendarItems.by.contextId = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_item ci join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left \
join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where site.context_id=? 

select.CalendarItems.by.entityReference = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_item ci join dash_context site on site.id=ci.context_id  \
join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id where ci.entity_ref=?

select.CalendarItems.by.repeatingEvent = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype,  ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \ 
from dash_calendar_item ci join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type \
left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where ci.repeating_event_id=? order by ci.calendar_time asc

select.CalendarItems.by.sakaiId = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_person usr join dash_calendar_link link on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where usr.sakai_id=? order by ci.calendar_time asc

select.CalendarItems.by.sakaiId.contextId = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_person usr join dash_calendar_link link on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where usr.sakai_id=? and site.context_id=? order by ci.calendar_time asc

select.CalendarItems.by.sakaiId.contextId.hidden = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_person usr join dash_calendar_link link on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where link.hidden=1 and usr.sakai_id=? and site.context_id=? order by ci.calendar_time asc

select.CalendarItems.by.sakaiId.contextId.sticky = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_person usr join dash_calendar_link link on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where link.sticky=1 and usr.sakai_id=? and site.context_id=? order by ci.calendar_time asc

select.CalendarItems.by.sakaiId.hidden = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_person usr join dash_calendar_link link on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where link.hidden=1 and usr.sakai_id=? order by ci.calendar_time asc

select.CalendarItems.by.sakaiId.sticky = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_person usr join dash_calendar_link link on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where link.sticky=1 and usr.sakai_id=? order by ci.calendar_time asc

select.SequenceNumbers.entityReference.calendarTimeLabelKey.sequenceNumber = select sequence_num from dash_calendar_item where entity_ref=? and calendar_time_label_key=? and sequence_num>=?

select.CalendarLink.by.calendarItemId.personId = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_link link join dash_person usr on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where link.item_id=? and link.person_id=?

select.CalendarLink.by.id = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_link link join dash_person usr on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where link.id=?

select.future.CalendarLinks.by.sakaiId.hidden = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_link link join dash_person usr on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where usr.sakai_id=? and link.hidden=? and ci.calendar_time>? order by ci.calendar_time asc

select.future.CalendarLinks.by.sakaiId.contextId.hidden = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_link link join dash_person usr on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where usr.sakai_id=? and site.context_id=? and link.hidden=? and ci.calendar_time>? order by ci.calendar_time asc

select.past.CalendarLinks.by.sakaiId.hidden = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_link link join dash_person usr on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where usr.sakai_id=? and link.hidden=? and ci.calendar_time<? order by ci.calendar_time desc

select.past.CalendarLinks.by.sakaiId.contextId.hidden = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_link link join dash_person usr on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where usr.sakai_id=? and site.context_id=? and link.hidden=? and ci.calendar_time<? order by ci.calendar_time desc

select.starred.CalendarLinks.by.sakaiId = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_link link join dash_person usr on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where usr.sakai_id=? and link.sticky=1 order by ci.calendar_time asc

select.starred.CalendarLinks.by.sakaiId.contextId = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, \
ci.subtype as ci_subtype, ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_link link join dash_person usr on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where usr.sakai_id=? and site.context_id=? and link.sticky=1 order by ci.calendar_time asc

select.Config.by.propertyName = select property_value from dash_config where property_name=?

select.Context.by.contextId = select site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title from dash_context site where site.context_id=?

select.motd.recent = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, st.id as type_id, st.identifier as type_identifier, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title \
from dash_news_item ni join dash_context site on site.id=ni.context_id  \
join dash_sourcetype st on st.id=ni.entity_type where site.context_id=? order by ni.news_time desc

select.NewsItem.by.entityReference = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title \
from dash_news_item ni join dash_context site on site.id=ni.context_id  \
join dash_sourcetype st on st.id=ni.entity_type where ni.entity_ref=?

select.NewsItem.by.id = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title \
from dash_news_item ni join dash_context site on site.id=ni.context_id  \
join dash_sourcetype st on st.id=ni.entity_type where ni.id=?

select.NewsItems.by.contextId = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title \
from dash_news_item ni join dash_context site on site.id=ni.context_id join dash_sourcetype st on st.id=ni.entity_type  \
where site.context_id=? 

select.NewsLink.by.newsItemId.personId = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, \
ni.news_time_label_key as ni_news_time_label_key, ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky \
from dash_news_link link join dash_person usr on usr.id=link.person_id join dash_news_item ni on ni.id=link.item_id \
join dash_context site on site.id=ni.context_id join dash_sourcetype st on st.id=ni.entity_type \
where link.item_id=? and link.person_id=?

count.NewsLinks.by.sakaiId.groupId = select count(*)  \
from dash_person usr join dash_news_link link on usr.id=link.person_id \
join dash_news_item ni on link.item_id=ni.id \
where usr.sakai_id=? and ni.grouping_id=? and link.hidden=0

select.NewsLinks.by.sakaiId.groupId.paged = select * from (select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, \
ni.news_time_label_key as ni_news_time_label_key, ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, ni.grouping_id as ni_group, 1 as ni_count, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id, \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky, ROWNUM as rn \
from dash_person usr join dash_news_link link on usr.id=link.person_id \
join dash_news_item ni on link.item_id=ni.id \
join dash_context site on site.id=ni.context_id \
join dash_sourcetype st on st.id=ni.entity_type \
where usr.sakai_id=? and ni.grouping_id=? and link.hidden=0 and ROWNUM<?) \
where rn>?

select.current.NewsLinks.by.sakaiUserId = (select 0 as ni_id, t5.g_time as ni_news_time, '' as ni_title, \
t5.label_key as ni_news_time_label_key, t5.g_id as ni_entity_ref, '' as ni_subtype, t5.g_id as ni_group, t5.g_count as ni_count, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id, site.context_url as site_context_url, site.context_title as site_context_title, \
t5.usr_id as p_id, t5.usr_sakai_id as p_sakai_id, t5.usr_user_id as p_user_id, \
0 as link_id, 0 as link_hidden, 0 as link_sticky \
from (select dp_id as usr_id, dp_sakai_id as usr_sakai_id, dp_user_id as usr_user_id, \
t4.x as g_id, t4.label_key as label_key, t4.y as g_count,t4.z \
as g_time, t4.nl_id as nl_id, t4.site_id as site_id, t4.type_id as entity_type \
from (select dp.id as dp_id, dp.sakai_id as dp_sakai_id, dp.user_id as dp_user_id, \
dni.grouping_id as x,count(*) as y, \
max(dni.news_time) as z, min(dni.news_time_label_key) as label_key, min(dnl.id) as nl_id, \
min(dni.entity_type) as type_id, min(dni.context_id) as site_id \
from dash_person dp join dash_news_link dnl on dp.id=dnl.person_id \
join dash_news_item dni on dni.id=dnl.item_id \
join dash_context dc on dnl.context_id=dc.id \
where dp.sakai_id=? and dnl.hidden=0 group by dp.id, dp.sakai_id, dp.user_id, grouping_id) t4 where t4.y > ?) t5 \
join dash_context site on t5.site_id=site.id \
join dash_sourcetype st on st.id=t5.entity_type) \
union \
(select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, ni.grouping_id as ni_group, 1 as ni_count, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id, site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id, \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky \
from (select t4.gr_id as gr_id from \
(select dni.grouping_id as gr_id, count(*) as gr_ct from dash_person dp join dash_news_link dnl on dp.id=dnl.person_id \
join dash_news_item dni on dni.id=dnl.item_id where dp.sakai_id=? and dnl.hidden=0 group by dni.grouping_id) t4 \
where t4.gr_ct <= ?) t5 \
join dash_news_item ni on t5.gr_id=ni.grouping_id \
join dash_news_link link on link.item_id=ni.id \
join dash_person usr on usr.id=link.person_id \
join dash_context site on site.id=ni.context_id \
join dash_sourcetype st on st.id=ni.entity_type \
where usr.sakai_id=? and link.hidden=0) \
order by ni_news_time desc

select.current.NewsLinks.by.sakaiUserId.contextId = (select 0 as ni_id, t5.g_time as ni_news_time, '' as ni_title, \
t5.label_key as ni_news_time_label_key, t5.g_id as ni_entity_ref, '' as ni_subtype, t5.g_id as ni_group, t5.g_count as ni_count, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id, site.context_url as site_context_url, site.context_title as site_context_title, \
t5.usr_id as p_id, t5.usr_sakai_id as p_sakai_id, t5.usr_user_id as p_user_id, \
0 as link_id, 0 as link_hidden, 0 as link_sticky \
from (select dp_id as usr_id, dp_sakai_id as usr_sakai_id, dp_user_id as usr_user_id, \
t4.x as g_id, t4.label_key as label_key,t4.y as g_count,t4.z as g_time, t4.nl_id as nl_id, t4.site_id as site_id, t4.type_id as entity_type \
from (select dp.id as dp_id, dp.sakai_id as dp_sakai_id, dp.user_id as dp_user_id, dni.grouping_id as x,count(*) as y, \
max(dni.news_time) as z, min(dni.news_time_label_key) as label_key, min(dnl.id) as nl_id, min(dni.entity_type) as type_id, min(dni.context_id) as site_id \
from dash_person dp join dash_news_link dnl on dp.id=dnl.person_id \
join dash_news_item dni on dni.id=dnl.item_id \
join dash_context dc on dnl.context_id=dc.id \
where dp.sakai_id=? and dc.context_id=? and dnl.hidden=0 \
group by dp.id, dp.sakai_id, dp.user_id, grouping_id) t4 where t4.y > ?) t5 \
join dash_context site on t5.site_id=site.id join dash_sourcetype st on st.id=t5.entity_type ) \
union \
(select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, ni.grouping_id as ni_group, 1 as ni_count, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id, site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id, \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky \
from (select t4.gr_id as gr_id \
from (select dni.grouping_id as gr_id, count(*) as gr_ct from dash_person dp join dash_news_link dnl on dp.id=dnl.person_id \
join dash_news_item dni on dni.id=dnl.item_id where dp.sakai_id=? and dnl.hidden=0 group by dni.grouping_id) t4 \
where t4.gr_ct <= ?) t5 \
join dash_news_item ni on t5.gr_id=ni.grouping_id \
join dash_news_link link on link.item_id=ni.id \
join dash_person usr on usr.id=link.person_id \
join dash_context site on site.id=ni.context_id \
join dash_sourcetype st on st.id=ni.entity_type \
where usr.sakai_id=? and site.context_id=? and link.hidden=0) \
order by ni_news_time desc

select.starred.NewsLinks.by.sakaiUserId = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, \
ni.news_time_label_key as ni_news_time_label_key, ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky \
from dash_news_link link join dash_person usr on usr.id=link.person_id join dash_news_item ni on ni.id=link.item_id \
join dash_context site on site.id=ni.context_id join dash_sourcetype st on st.id=ni.entity_type \
where usr.sakai_id=? and link.sticky=1 order by ni.news_time desc 

select.starred.NewsLinks.by.sakaiUserId.contextId = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, \
ni.news_time_label_key as ni_news_time_label_key, ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky \
from dash_news_link link join dash_person usr on usr.id=link.person_id join dash_news_item ni on ni.id=link.item_id \
join dash_context site on site.id=ni.context_id join dash_sourcetype st on st.id=ni.entity_type \
where usr.sakai_id=? and site.context_id=? and link.sticky=1 order by ni.news_time desc 

select.hidden.NewsLinks.by.sakaiUserId = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, \
ni.news_time_label_key as ni_news_time_label_key, ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky \
from dash_news_link link join dash_person usr on usr.id=link.person_id join dash_news_item ni on ni.id=link.item_id \
join dash_context site on site.id=ni.context_id join dash_sourcetype st on st.id=ni.entity_type \
where usr.sakai_id=? and link.hidden=1 order by ni.news_time desc 

select.hidden.NewsLinks.by.sakaiUserId.contextId = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, \
ni.news_time_label_key as ni_news_time_label_key, ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky \
from dash_news_link link join dash_person usr on usr.id=link.person_id join dash_news_item ni on ni.id=link.item_id \
join dash_context site on site.id=ni.context_id join dash_sourcetype st on st.id=ni.entity_type \
where usr.sakai_id=? and site.context_id=? and link.hidden=1 order by ni.news_time desc 

select.Person.by.sakaiId = select id as p_id, sakai_id as p_sakai_id, user_id as p_user_id from dash_person where sakai_id=?

select.Person.sakaiId.by.calendarLink = select usr.sakai_id from dash_person usr join dash_calendar_link link on link.person_id=usr.id where link.item_id=?

select.RepeatingCalendarItem.by.entityReference.calendarTimeLabelKey = select rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, \
rep.frequency as rep_frequency, rep.max_count as rep_count, rep.calendar_time_label_key as rep_calendar_time_label_key, \
rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title \
from dash_repeating_event rep join dash_context site on site.id=rep.context_id join dash_sourcetype st on st.id=rep.entity_type \
where rep.entity_ref = ? and rep.calendar_time_label_key = ?

select.RepeatingEvents = select rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, \
rep.frequency as rep_frequency, rep.max_count as rep_count, rep.calendar_time_label_key as rep_calendar_time_label_key, \
rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype, \
st.id as type_id, st.identifier as type_identifier, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title \
from dash_repeating_event rep join dash_context site on site.id=rep.context_id join dash_sourcetype st on st.id=rep.entity_type \
where (rep.last_time is null or \
trunc(rep.last_time) > \
(select trunc(max(t.calendar_time)) as max_calendar_time \
from dash_calendar_item t, dash_repeating_event tt \
where t.repeating_event_id=tt.id and t.calendar_time is not null)) \
and rep.id not in ( \
select t3.id \
from dash_repeating_event t3, \
(select t1.id as id, count(*) as item_count \
from dash_repeating_event t1, dash_calendar_item t2 \
where t1.id = t2.repeating_event_id \
group by t1.id) t4 \
where t3.id = t4.id \
and (t3.max_count is not null and t3.max_count != 0) \
and t3.max_count = t4.item_count) \
order by rep.first_time asc

select.sakaiUserIds.in.calendarLinks.by.entityReference = select person.sakai_id from dash_person person \
join dash_calendar_link link on link.person_id=person.id join dash_calendar_item item on link.item_id=item.id \
where item.entity_ref=?  

select.sakaiUserIds.in.newsLinks.by.entityReference = select person.sakai_id from dash_person person \
join dash_news_link link on link.person_id=person.id join dash_news_item item on link.item_id=item.id \
where item.entity_ref=?  

select.SourceType.by.identifier = select st.id as type_id, st.identifier as type_identifier  from dash_sourcetype st where identifier=?

update.CalendarItem = update dash_calendar_item set calendar_time = ?, calendar_time_label_key = ?, title = ?, \
entity_ref = ?, subtype = ?, entity_type = ?, context_id = ? repeating_event_id = NULL, sequence_num = NULL where id = ?

update.CalendarItem.repeats = update dash_calendar_item set calendar_time = ?, calendar_time_label_key = ?, title = ?, \
entity_ref = ?, subtype = ?, entity_type = ?, context_id = ?, repeating_event_id = ?, sequence_num = ? where id = ?

update.CalendarItem.calendarTime = update dash_calendar_item set calendar_time=? where id=?

update.CalendarItem.calendarTime.entityReference.labelKey = update dash_calendar_item set calendar_time=? where entity_ref=? and calendar_time_label_key=? and sequence_num is NULL

update.CalendarItem.calendarTime.entityReference.labelKey.sequenceNumber = update dash_calendar_item set calendar_time=? where entity_ref=? and calendar_time_label_key=? and sequence_num=?

update.CalendarItem.title = update dash_calendar_item set title=? where id=?

update.CalendarItemsLabelKey.entityReference.oldLabelKey = update dash_calendar_item set calendar_time_label_key=? where entity_ref=? and calendar_time_label_key=?

update.CalendarLink = update dash_calendar_link set person_id=?, item_id=?, context_id=?, hidden=?, sticky=? where id=?

update.Config.propertyName = update dash_config set property_value=? where property_name=?

update.Context.title = update dash_context set context_title=? where context_id=?

update.NewsItem.newsTime = update dash_news_item set news_time=?, grouping_id=? where id=?

update.NewsItem.newsTimeLabelKey = update dash_news_item set news_time_label_key=?, grouping_id=? where id=?

update.NewsItem.title = update dash_news_item set title=?,news_time=?,news_time_label_key=?, grouping_id=? where id=?

update.NewsLink = update dash_news_link set person_id=?, item_id=?, context_id=?, hidden=?, sticky=? where id=?

update.RepeatingEventsFrequency.entityReference = update dash_repeating_event set frequency=? where entity_ref=?

update.RepeatingEventsLabelKey.entityReference.oldLabelKey = update dash_repeating_event set calendar_time_label_key=? where entity_ref=? and calendar_time_label_key=?

update.RepeatingEventsTime.entityReference = update dash_repeating_event set first_time=?,last_time=? where entity_ref=? 

update.RepeatingEventsTitle.entityReference = update dash_repeating_event set title=? where entity_ref=? 

update.AvailabilityCheck = update dash_availability_check set scheduled_time = ? where entity_ref = ?

create.TaskLock.table = create table dash_task_lock \
( id number not null primary key, \
task varchar2(255) not null, server_id varchar2(255) not null, claim_time timestamp(9), \
last_update timestamp(9), has_lock number(1,0) default 0); \
create sequence dash_task_lock_seq start with 1 increment by 1 nomaxvalue; \
create index dash_lock_ct_idx on dash_task_lock (claim_time); \
create unique index dash_lock_ts_idx on dash_task_lock (task, server_id) 

delete.TaskLock.by.task = delete from dash_task_lock where task=?

insert.TaskLock = insert into dash_task_lock (id, task, server_id, claim_time, last_update, has_lock) values (dash_task_lock_seq.NEXTVAL, ?, ?, ?, ?, ?)

select.TaskLocks.by.task = select id,task,server_id,claim_time,last_update,has_lock \
from dash_task_lock where task=? order by claim_time

select.TaskLocks.by.task.serverId = select id,task,server_id,claim_time,last_update,has_lock \
from dash_task_lock where task=? and server_id=?

select.TaskLocks.by.hasLock = select id,task,server_id,claim_time,last_update,has_lock \
from dash_task_lock where has_lock=1

update.TaskLock.hasLock = update dash_task_lock set has_lock=?, last_update=? where id=?

update.TaskLock.lastUpdate = update dash_task_lock set last_update=? where task=? and server_id=?

delete.RepeatingEvent.by.id = delete from dash_repeating_event where id=?

select.context.user.from.calendar.link = select concat(concat(t3.context_id, ' '), t4.SAKAI_ID) as context_users \
from \
(select distinct t1.context_id, t2.person_id \
from dash_context t1, \
(select  context_id, person_id \
from dash_calendar_link) t2 \
where t1.id = t2.context_id) t3, \
dash_person t4 \
where t3.person_id= t4.id \
order by t3.context_id 

select.context.user.from.news.link = select concat(concat(t3.context_id, ' '), t4.SAKAI_ID) as context_users \
from \
(select distinct t1.context_id, t2.person_id \
from dash_context t1, \
(select context_id, person_id \
from dash_news_link) t2 \
where t1.id = t2.context_id) t3, \
dash_person t4 \
where t3.person_id= t4.id \
order by t3.context_id 

